# ---------------------------------------------------------------
# Target Repo → Backlog Resolver Dispatch
# ---------------------------------------------------------------
# Copy this file into the TARGET repo at:
#   .github/workflows/backlog-resolver-dispatch.yml
#
# Required secrets in the TARGET repo:
#   BACKLOG_RESOLVER_PAT – a PAT with `repo` scope on the
#                          backlog-resolver repo (to send the dispatch).
#
# Update BACKLOG_RESOLVER_REPO below to match your setup.
# ---------------------------------------------------------------
name: Forward issues to Backlog Resolver

on:
  issues:
    types: [opened, edited, reopened, labeled]

env:
  # ── Change this to wherever your backlog-resolver repo lives ──
  BACKLOG_RESOLVER_REPO: colepa/backlog-resolver

jobs:
  dispatch:
    # Only dispatch for open/edit/reopen OR when a devin: label is added.
    if: >-
      github.event.action != 'labeled' ||
      startsWith(github.event.label.name, 'devin:')
    runs-on: ubuntu-latest
    steps:
      - name: Send repository_dispatch to backlog-resolver
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.BACKLOG_RESOLVER_PAT }}
          repository: ${{ env.BACKLOG_RESOLVER_REPO }}
          event-type: issue-intake
          client-payload: |
            {
              "repo": "${{ github.repository }}",
              "issue_number": ${{ github.event.issue.number }},
              "action": "${{ github.event.action }}",
              "label": "${{ github.event.label.name || '' }}"
            }
